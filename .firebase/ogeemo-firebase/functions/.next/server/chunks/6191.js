exports.id=6191,exports.ids=[6191],exports.modules={29380:(e,s,t)=>{Promise.resolve().then(t.bind(t,52972))},52972:(e,s,t)=>{"use strict";t.d(s,{ClientTimeLogReport:()=>z});var i=t(10326),n=t(17577),l=t(90434),r=t(35047),a=t(51027),c=t(91664),d=t(61486),o=t(33194),h=t(29752),x=t(41156),m=t(44794),j=t(73877),u=t(49708),p=t(9921),f=t(18615),g=t(46721),N=t(70744),v=t(60883),y=t(14289),b=t(64150),w=t(37084),C=t(69559),S=t(31232),P=t(98181),D=t(68136),Z=t(84097),L=t(32589),R=t(65532),T=t(51223),$=t(10143),F=t(55296),k=t(18089);let M=e=>`${Math.floor(e/3600)}h ${Math.floor(e%3600/60)}m`,O=e=>{let s=new Date(e);return s.setHours(23,59,59,999),s};function z(){let[e,s]=(0,n.useState)([]),[t,z]=(0,n.useState)([]),[U,W]=(0,n.useState)(!0),[I,Y]=(0,n.useState)(null),[A,E]=(0,n.useState)(void 0),[B,J]=(0,n.useState)(!1),[_,H]=(0,n.useState)(null),[X,q]=(0,n.useState)(null),{user:G}=(0,D.a)(),{toast:Q}=(0,Z.pm)(),{handlePrint:K,contentRef:V}=(0,L.Y)(),ee=(0,r.useRouter)(),es=(0,n.useMemo)(()=>I?t.filter(e=>e.accountId===I).filter(e=>{if(!A||!A.from)return!0;let s=new Date(e.startTime),t=A.to||A.from;return s>=A.from&&s<=O(t)}):[],[I,t,A]),et=(0,n.useMemo)(()=>es.reduce((e,s)=>e+s.duration,0),[es]),ei=(0,n.useMemo)(()=>es.reduce((e,s)=>e+s.duration/3600*s.billableRate,0),[es]),en=async e=>{try{await (0,R.Q_)(e.id,e),z(s=>s.map(s=>s.id===e.id?{...s,...e}:s)),Q({title:"Entry Updated",description:"Your changes have been saved."})}catch(e){Q({variant:"destructive",title:"Update Failed",description:e.message})}},el=async()=>{if(X)try{await (0,R.Zs)(X.id),z(e=>e.filter(e=>e.id!==X.id)),Q({title:"Entry Deleted",description:`The log entry "${X.subject}" has been removed.`})}catch(e){Q({variant:"destructive",title:"Delete Failed",description:e.message})}finally{q(null)}},er=e.find(e=>e.id===I);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"p-4 sm:p-6 space-y-6",children:[(0,i.jsxs)("header",{className:"flex items-center justify-between print:hidden",children:[(0,i.jsxs)("div",{children:[i.jsx("h1",{className:"text-3xl font-bold font-headline text-primary",children:"Client Time Log Report"}),i.jsx("p",{className:"text-muted-foreground",children:"Generate a detailed report of time logged for a client."})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)(c.z,{variant:"outline",onClick:()=>{if(!er||0===es.length){Q({variant:"destructive",title:"Cannot Create Invoice",description:"Please select a client with time log entries in the selected range."});return}let e=es.filter(e=>e.billableRate>0&&e.duration>0).map(e=>{let s=e.duration/3600;return{description:`${e.subject} - ${(0,P.WU)(e.startTime,"PPP")}`,quantity:parseFloat(s.toFixed(2)),price:e.billableRate}});if(0===e.length){Q({variant:"destructive",title:"No Billable Items",description:"There are no billable time entries in this report."});return}try{let s={contactId:er.contactId,lineItems:e};sessionStorage.setItem("invoiceFromReportData",JSON.stringify(s)),ee.push("/accounting/invoices/create")}catch(e){console.error("Failed to prepare invoice data:",e),Q({variant:"destructive",title:"Error",description:"Could not prepare the invoice data for generation."})}},disabled:!I,children:[i.jsx(j.Z,{className:"mr-2 h-4 w-4"}),"Create Invoice"]}),(0,i.jsxs)(c.z,{variant:"outline",onClick:K,disabled:!I,children:[i.jsx(u.Z,{className:"mr-2 h-4 w-4"}),"Print Report"]}),i.jsx(c.z,{asChild:!0,children:(0,i.jsxs)(l.default,{href:"/client-manager",children:[i.jsx(p.Z,{className:"mr-2 h-4 w-4"}),"Back to Client Hub"]})})]})]}),(0,i.jsxs)(h.Zb,{className:"print:hidden",children:[i.jsx(h.Ol,{children:i.jsx(h.ll,{children:"Report Filters"})}),(0,i.jsxs)(h.aY,{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[i.jsx(m.Label,{children:"Client"}),(0,i.jsxs)(a.J2,{open:B,onOpenChange:J,children:[i.jsx(a.xo,{asChild:!0,children:(0,i.jsxs)(c.z,{variant:"outline",role:"combobox",className:"w-full justify-between",children:[er?.name||"Select client...",i.jsx(f.Z,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),i.jsx(a.yk,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,i.jsxs)(d.mY,{children:[i.jsx(d.sZ,{placeholder:"Search clients..."}),(0,i.jsxs)(d.e8,{children:[i.jsx(d.rb,{children:U?i.jsx(g.Z,{className:"h-4 w-4 animate-spin"}):"No client found."}),i.jsx(d.fu,{children:e.map(e=>(0,i.jsxs)(d.di,{value:e.name,onSelect:()=>{Y(e.id),J(!1)},children:[" ",i.jsx(N.Z,{className:(0,T.cn)("mr-2 h-4 w-4",I===e.id?"opacity-100":"opacity-0")}),e.name]},e.id))})]})]})})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[i.jsx(m.Label,{children:"Date Range"}),(0,i.jsxs)(a.J2,{children:[i.jsx(a.xo,{asChild:!0,children:(0,i.jsxs)(c.z,{variant:"outline",className:(0,T.cn)("w-full justify-start text-left font-normal",!A&&"text-muted-foreground"),children:[i.jsx(v.Z,{className:"mr-2 h-4 w-4"}),A?.from?A.to?`${(0,P.WU)(A.from,"LLL dd, y")} - ${(0,P.WU)(A.to,"LLL dd, y")}`:(0,P.WU)(A.from,"LLL dd, y"):i.jsx("span",{children:"Pick a date range"})]})}),i.jsx(a.yk,{className:"w-auto p-0",align:"start",children:i.jsx(o.f,{initialFocus:!0,mode:"range",defaultMonth:A?.from,selected:A,onSelect:E,numberOfMonths:2})})]})]}),(0,i.jsxs)("div",{className:"flex items-end gap-2",children:[i.jsx(c.z,{variant:"secondary",onClick:()=>E({from:(0,C.N)(new Date),to:new Date}),className:"w-full",children:"Month to Date"}),i.jsx(c.z,{variant:"secondary",onClick:()=>E({from:(0,S.e)(new Date),to:new Date}),className:"w-full",children:"Year to Date"}),i.jsx(c.z,{variant:"secondary",onClick:()=>E(void 0),className:"w-full",children:"Clear"})]})]})]}),i.jsx("div",{ref:V,children:(0,i.jsxs)(h.Zb,{className:"print:border-none print:shadow-none",children:[(0,i.jsxs)(h.Ol,{className:"text-center",children:[(0,i.jsxs)(h.ll,{className:"text-2xl",children:[er?.name||"Client"," - Time Report"]}),i.jsx(h.SZ,{children:A?.from?A.to?`${(0,P.WU)(A.from,"PPP")} to ${(0,P.WU)(A.to,"PPP")}`:`On ${(0,P.WU)(A.from,"PPP")}`:"All time"})]}),i.jsx(h.aY,{children:U?i.jsx("div",{className:"h-48 flex items-center justify-center",children:i.jsx(g.Z,{className:"h-8 w-8 animate-spin"})}):I?(0,i.jsxs)(x.iA,{children:[i.jsx(x.xD,{children:(0,i.jsxs)(x.SC,{children:[i.jsx(x.ss,{children:"Date"}),i.jsx(x.ss,{children:"Subject"}),i.jsx(x.ss,{className:"text-right",children:"Duration"}),i.jsx(x.ss,{className:"text-right",children:"Billable"}),i.jsx(x.ss,{className:"w-10",children:i.jsx("span",{className:"sr-only",children:"Actions"})})]})}),i.jsx(x.RM,{children:es.length>0?es.map(e=>(0,i.jsxs)(x.SC,{children:[i.jsx(x.pj,{children:(0,P.WU)(e.startTime,"yyyy-MM-dd")}),i.jsx(x.pj,{children:e.subject}),i.jsx(x.pj,{className:"text-right font-mono",children:M(e.duration)}),(0,i.jsxs)(x.pj,{className:"text-right font-mono",children:["$",(e.duration/3600*e.billableRate).toFixed(2)]}),i.jsx(x.pj,{children:(0,i.jsxs)($.h_,{children:[i.jsx($.$F,{asChild:!0,children:i.jsx(c.z,{variant:"ghost",size:"icon",className:"h-8 w-8",children:i.jsx(y.Z,{className:"h-4 w-4"})})}),(0,i.jsxs)($.AW,{align:"end",children:[(0,i.jsxs)($.Xi,{onSelect:()=>H(e),children:[i.jsx(b.Z,{className:"mr-2 h-4 w-4"}),"Open / Edit"]}),(0,i.jsxs)($.Xi,{className:"text-destructive",onSelect:()=>q(e),children:[i.jsx(w.Z,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},e.id)):i.jsx(x.SC,{children:i.jsx(x.pj,{colSpan:5,className:"h-24 text-center",children:"No entries found for this period."})})}),i.jsx(x.yt,{children:(0,i.jsxs)(x.SC,{children:[i.jsx(x.pj,{colSpan:2,className:"font-bold",children:"Totals"}),i.jsx(x.pj,{className:"text-right font-bold font-mono",children:M(et)}),(0,i.jsxs)(x.pj,{className:"text-right font-bold font-mono",children:["$",ei.toFixed(2)]}),i.jsx(x.pj,{})]})})]}):i.jsx("div",{className:"h-48 flex items-center justify-center",children:i.jsx("p",{className:"text-muted-foreground",children:"Please select a client to generate a report."})})})]})})]}),i.jsx(k.Z,{isOpen:!!_,onOpenChange:()=>H(null),entry:_,onSave:en}),i.jsx(F.aR,{open:!!X,onOpenChange:()=>q(null),children:(0,i.jsxs)(F._T,{children:[(0,i.jsxs)(F.fY,{children:[i.jsx(F.f$,{children:"Are you absolutely sure?"}),(0,i.jsxs)(F.yT,{children:['This action will permanently delete the log entry: "',X?.subject,'". This cannot be undone.']})]}),(0,i.jsxs)(F.xo,{children:[i.jsx(F.le,{children:"Cancel"}),i.jsx(F.OL,{onClick:el,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})})]})}},81672:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});var i=t(68570);let n=(0,i.createProxy)(String.raw`/home/user/studio/src/components/client-manager/client-time-log-report.tsx`),{__esModule:l,$$typeof:r}=n;n.default;let a=(0,i.createProxy)(String.raw`/home/user/studio/src/components/client-manager/client-time-log-report.tsx#ClientTimeLogReport`)}};