(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2608],{27709:function(e,t,r){Promise.resolve().then(r.bind(r,10084))},10084:function(e,t,r){"use strict";r.d(t,{LogManagerView:function(){return D}});var n=r(57437),a=r(2265),s=r(87138),i=r(48185),o=r(89733),l=r(21413),c=r(34063),d=r(77209),u=r(70402),h=r(86644),p=r(49489),f=r(17219),m=r(38087),x=r(60926),g=r(94729),v=r(86763),j=r(19779),b=r(68965),N=r(54662),y=r(44541),C=r(25695),w=r(67188),k=r(25648);let S=e=>"".concat(String(Math.floor(e/3600)).padStart(2,"0"),":").concat(String(Math.floor(e%3600/60)).padStart(2,"0"),":").concat(String(Math.floor(e%60)).padStart(2,"0")),P="timeClockDialogState";function E(e){let{isOpen:t,onOpenChange:r,onLogTime:s}=e,[i,l]=(0,a.useState)(0),[c,d]=(0,a.useState)(!1),[h,p]=(0,a.useState)(!0),[f,m]=(0,a.useState)(!1),[x,g]=(0,a.useState)(!1),j=(0,a.useRef)(null),{toast:b}=(0,v.pm)();(0,a.useEffect)(()=>(c&&!h?j.current=setInterval(()=>{l(e=>e+1)},1e3):j.current&&clearInterval(j.current),()=>{j.current&&clearInterval(j.current)}),[c,h]);let E=(0,a.useCallback)(()=>{d(!1),p(!0),l(0),m(!1),g(!1),localStorage.removeItem(P)},[]);(0,a.useEffect)(()=>{if(t)try{let e=localStorage.getItem(P);if(e){let t=JSON.parse(e),r=!t.isPaused&&t.isActive?Math.floor((Date.now()-t.lastTickTimestamp)/1e3):0;l(t.elapsedSeconds+r),d(t.isActive),p(t.isPaused),m(!0)}}catch(e){console.error("Failed to parse timer state from localStorage",e),E()}},[t,E]);let O=e=>{if(!e){if(f&&c){let e={elapsedSeconds:i,isActive:c,isPaused:h,lastTickTimestamp:Date.now()};localStorage.setItem(P,JSON.stringify(e))}else E()}r(e)};return(0,n.jsx)(N.Vq,{open:t,onOpenChange:O,children:(0,n.jsxs)(N.cZ,{className:"sm:max-w-md",children:[(0,n.jsxs)(N.fK,{children:[(0,n.jsx)(N.$N,{children:"Time Clock"}),(0,n.jsx)(N.Be,{children:'Track time for this task. The timer will reset if you close this dialog unless "Keep running" is checked.'})]}),(0,n.jsx)("div",{className:"py-8 text-center",children:(0,n.jsx)("p",{className:"text-6xl font-mono font-bold text-primary tracking-tight",children:S(i)})}),(0,n.jsx)("div",{className:"flex items-center justify-center space-x-2",children:c?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(o.z,{onClick:()=>{p(!h)},variant:"outline",size:"lg",className:"w-48",children:[h?(0,n.jsx)(C.Z,{className:"mr-2 h-5 w-5"}):(0,n.jsx)(w.Z,{className:"mr-2 h-5 w-5"}),h?"Resume":"Pause"]}),(0,n.jsxs)(o.z,{onClick:()=>{x&&b({title:"Time Saved to Client File",description:"".concat(S(i)," has been logged to the client file.")}),s(i),E(),r(!1)},variant:"destructive",size:"lg",className:"w-48",children:[(0,n.jsx)(k.Z,{className:"mr-2 h-5 w-5"}),x?"Save time to client file":"Stop & Log"]})]}):(0,n.jsxs)(o.z,{onClick:()=>{d(!0),p(!1),l(0)},variant:"outline",size:"lg",className:"w-48",children:[(0,n.jsx)(C.Z,{className:"mr-2 h-5 w-5"})," Start"]})}),(0,n.jsxs)("div",{className:"flex items-center space-x-4 pt-4 justify-center",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(y.Checkbox,{id:"keep-running",checked:f,onCheckedChange:e=>{let t=!!e;m(t),t||c||localStorage.removeItem(P)}}),(0,n.jsx)(u.Label,{htmlFor:"keep-running",className:"cursor-pointer text-xs",children:"Keep running"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(y.Checkbox,{id:"save-to-client",checked:x,onCheckedChange:e=>g(!!e)}),(0,n.jsx)(u.Label,{htmlFor:"save-to-client",className:"cursor-pointer text-xs",children:"Log to client file"})]})]}),(0,n.jsx)(N.cN,{children:(0,n.jsx)(o.z,{variant:"ghost",onClick:()=>O(!1),children:"Close"})})]})})}var O=r(49354);let R=e=>"".concat(String(Math.floor(e/3600)).padStart(2,"0"),":").concat(String(Math.floor(e%3600/60)).padStart(2,"0"),":").concat(String(Math.floor(e%60)).padStart(2,"0"));function D(){var e;let[t,r]=(0,a.useState)([]),[N,y]=(0,a.useState)(!0),{user:C}=(0,j.a)(),[w,k]=(0,a.useState)(null),[S,P]=(0,a.useState)(!1),[D,F]=(0,a.useState)(""),[L,M]=(0,a.useState)(""),[T,Z]=(0,a.useState)(100),[I,z]=(0,a.useState)(!1),[_,A]=(0,a.useState)(0),{toast:V}=(0,v.pm)();(0,a.useEffect)(()=>{!async function(){if(!C){y(!1);return}y(!0);try{let e=await (0,b.PZ)(C.uid);r(e)}catch(e){V({variant:"destructive",title:"Failed to load clients",description:e.message})}finally{y(!1)}}()},[C,V]);let B=async()=>{if(!C){V({variant:"destructive",title:"Not logged in"});return}try{if(!w){V({variant:"destructive",title:"Cannot Log Entry",description:"No client is selected."});return}if(0===_){V({variant:"destructive",title:"Cannot Log Entry",description:"No time has been logged for this entry. Please use the time clock."});return}let e=t.find(e=>e.id===w);if(!e){V({variant:"destructive",title:"Cannot Log Entry",description:"Selected client could not be found."});return}let r={accountId:w,contactName:e.name,subject:D,detailsHtml:L.replace(/\n/g,"<br>"),startTime:new Date(Date.now()-1e3*_),endTime:new Date,duration:_,billableRate:T,userId:C.uid};await (0,b.MO)(r),A(0),F(""),M(""),k(null),localStorage.removeItem("timeClockDialogState"),V({title:"Entry Logged",description:"Logged ".concat(R(r.duration)," for ").concat(e.name,".")})}catch(e){console.error("Error logging event:",e),V({variant:"destructive",title:"Error Logging Entry",description:"Could not save the entry. Please check the console for details."})}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"p-4 sm:p-6 space-y-6",children:[(0,n.jsxs)("header",{className:"relative text-center",children:[(0,n.jsx)("div",{className:"absolute left-0 top-1/2 -translate-y-1/2",children:(0,n.jsx)(o.z,{asChild:!0,children:(0,n.jsxs)(s.default,{href:"/client-manager",children:[(0,n.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),"Back to Hub"]})})}),(0,n.jsx)("h1",{className:"text-3xl font-bold font-headline text-primary",children:"Client Log Manager"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Log a new time entry for a client."})]}),(0,n.jsxs)(i.Zb,{className:"max-w-4xl mx-auto",children:[(0,n.jsx)(i.Ol,{children:(0,n.jsxs)("div",{className:"flex justify-between items-start",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(i.ll,{children:"New Log Entry"}),(0,n.jsx)(i.SZ,{children:"Select a client, track time, and describe the action taken."})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("p",{className:"text-muted-foreground text-sm",children:"Time Logged"}),(0,n.jsx)("p",{className:"font-mono text-2xl font-bold",children:R(_)}),(0,n.jsxs)(o.z,{size:"sm",variant:"outline",className:"mt-2",onClick:()=>z(!0),disabled:!w||!D.trim(),children:[(0,n.jsx)(p.Z,{className:"mr-2 h-4 w-4"})," Open Time Clock"]})]})]})}),(0,n.jsxs)(i.aY,{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.Label,{htmlFor:"client-select-log",children:"Client"}),(0,n.jsxs)(l.J2,{open:S,onOpenChange:P,children:[(0,n.jsx)(l.xo,{asChild:!0,children:(0,n.jsxs)(o.z,{variant:"outline",role:"combobox","aria-expanded":S,className:"w-full justify-between",children:[w?null===(e=t.find(e=>e.id===w))||void 0===e?void 0:e.name:"Select client...",(0,n.jsx)(f.Z,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,n.jsx)(l.yk,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,n.jsxs)(c.mY,{children:[(0,n.jsx)(c.sZ,{placeholder:"Search clients..."}),(0,n.jsxs)(c.e8,{children:[(0,n.jsx)(c.rb,{children:N?(0,n.jsx)("div",{className:"flex items-center justify-center p-2",children:(0,n.jsx)(m.Z,{className:"h-4 w-4 animate-spin"})}):"No client found."}),(0,n.jsx)(c.fu,{children:t.map(e=>(0,n.jsxs)(c.di,{value:e.name,onSelect:()=>{k(e.id),P(!1)},children:[(0,n.jsx)(x.Z,{className:(0,O.cn)("mr-2 h-4 w-4",w===e.id?"opacity-100":"opacity-0")}),e.name]},e.id))})]})]})})]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.Label,{htmlFor:"billable-rate-log",children:"Billable Rate ($/hr)"}),(0,n.jsx)(d.I,{id:"billable-rate-log",type:"number",value:T,onChange:e=>Z(Number(e.target.value))})]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.Label,{htmlFor:"subject-log",children:"Subject / Task Description"}),(0,n.jsx)(d.I,{id:"subject-log",placeholder:"e.g., Drafting initial project proposal",value:D,onChange:e=>F(e.target.value)})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.Label,{htmlFor:"details-log",children:"Details"}),(0,n.jsx)("textarea",{id:"details-log",rows:8,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",placeholder:"Provide details about the work performed.",value:L,onChange:e=>M(e.target.value)})]})]}),(0,n.jsx)(i.eW,{className:"flex justify-end",children:(0,n.jsxs)(o.z,{onClick:B,children:[(0,n.jsx)(g.Z,{className:"mr-2 h-4 w-4"}),"Log Entry"]})})]})]}),(0,n.jsx)(E,{isOpen:I,onOpenChange:z,onLogTime:e=>{A(e),V({title:"Time Logged",description:"Timer stopped. ".concat(R(e)," is ready to be saved with this entry.")})}})]})}},44541:function(e,t,r){"use strict";r.d(t,{Checkbox:function(){return l}});var n=r(57437),a=r(2265),s=r(69324),i=r(60926),o=r(49354);let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(s.fC,{ref:t,className:(0,o.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...a,children:(0,n.jsx)(s.z$,{className:(0,o.cn)("flex items-center justify-center text-current"),children:(0,n.jsx)(i.Z,{className:"h-4 w-4"})})})});l.displayName=s.fC.displayName},61485:function(e,t,r){"use strict";r.d(t,{VY:function(){return W},fC:function(){return V},h_:function(){return K},xz:function(){return B}});var n=r(2265),a=r(78149),s=r(1584),i=r(98324),o=r(53938),l=r(20589),c=r(80467),d=r(53201),u=r(25510),h=r(56935),p=r(31383),f=r(25171),m=r(71538),x=r(91715),g=r(78369),v=r(17590),j=r(57437),b="Popover",[N,y]=(0,i.b)(b,[u.D7]),C=(0,u.D7)(),[w,k]=N(b),S=e=>{let{__scopePopover:t,children:r,open:a,defaultOpen:s,onOpenChange:i,modal:o=!1}=e,l=C(t),c=n.useRef(null),[h,p]=n.useState(!1),[f=!1,m]=(0,x.T)({prop:a,defaultProp:s,onChange:i});return(0,j.jsx)(u.fC,{...l,children:(0,j.jsx)(w,{scope:t,contentId:(0,d.M)(),triggerRef:c,open:f,onOpenChange:m,onOpenToggle:n.useCallback(()=>m(e=>!e),[m]),hasCustomAnchor:h,onCustomAnchorAdd:n.useCallback(()=>p(!0),[]),onCustomAnchorRemove:n.useCallback(()=>p(!1),[]),modal:o,children:r})})};S.displayName=b;var P="PopoverAnchor";n.forwardRef((e,t)=>{let{__scopePopover:r,...a}=e,s=k(P,r),i=C(r),{onCustomAnchorAdd:o,onCustomAnchorRemove:l}=s;return n.useEffect(()=>(o(),()=>l()),[o,l]),(0,j.jsx)(u.ee,{...i,...a,ref:t})}).displayName=P;var E="PopoverTrigger",O=n.forwardRef((e,t)=>{let{__scopePopover:r,...n}=e,i=k(E,r),o=C(r),l=(0,s.e)(t,i.triggerRef),c=(0,j.jsx)(f.WV.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":A(i.open),...n,ref:l,onClick:(0,a.M)(e.onClick,i.onOpenToggle)});return i.hasCustomAnchor?c:(0,j.jsx)(u.ee,{asChild:!0,...o,children:c})});O.displayName=E;var R="PopoverPortal",[D,F]=N(R,{forceMount:void 0}),L=e=>{let{__scopePopover:t,forceMount:r,children:n,container:a}=e,s=k(R,t);return(0,j.jsx)(D,{scope:t,forceMount:r,children:(0,j.jsx)(p.z,{present:r||s.open,children:(0,j.jsx)(h.h,{asChild:!0,container:a,children:n})})})};L.displayName=R;var M="PopoverContent",T=n.forwardRef((e,t)=>{let r=F(M,e.__scopePopover),{forceMount:n=r.forceMount,...a}=e,s=k(M,e.__scopePopover);return(0,j.jsx)(p.z,{present:n||s.open,children:s.modal?(0,j.jsx)(Z,{...a,ref:t}):(0,j.jsx)(I,{...a,ref:t})})});T.displayName=M;var Z=n.forwardRef((e,t)=>{let r=k(M,e.__scopePopover),i=n.useRef(null),o=(0,s.e)(t,i),l=n.useRef(!1);return n.useEffect(()=>{let e=i.current;if(e)return(0,g.Ry)(e)},[]),(0,j.jsx)(v.Z,{as:m.g7,allowPinchZoom:!0,children:(0,j.jsx)(z,{...e,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,a.M)(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),l.current||null===(t=r.triggerRef.current)||void 0===t||t.focus()}),onPointerDownOutside:(0,a.M)(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey,n=2===t.button||r;l.current=n},{checkForDefaultPrevented:!1}),onFocusOutside:(0,a.M)(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})})}),I=n.forwardRef((e,t)=>{let r=k(M,e.__scopePopover),a=n.useRef(!1),s=n.useRef(!1);return(0,j.jsx)(z,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var n,i;null===(n=e.onCloseAutoFocus)||void 0===n||n.call(e,t),t.defaultPrevented||(a.current||null===(i=r.triggerRef.current)||void 0===i||i.focus(),t.preventDefault()),a.current=!1,s.current=!1},onInteractOutside:t=>{var n,i;null===(n=e.onInteractOutside)||void 0===n||n.call(e,t),t.defaultPrevented||(a.current=!0,"pointerdown"!==t.detail.originalEvent.type||(s.current=!0));let o=t.target;(null===(i=r.triggerRef.current)||void 0===i?void 0:i.contains(o))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&s.current&&t.preventDefault()}})}),z=n.forwardRef((e,t)=>{let{__scopePopover:r,trapFocus:n,onOpenAutoFocus:a,onCloseAutoFocus:s,disableOutsidePointerEvents:i,onEscapeKeyDown:d,onPointerDownOutside:h,onFocusOutside:p,onInteractOutside:f,...m}=e,x=k(M,r),g=C(r);return(0,l.EW)(),(0,j.jsx)(c.M,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:a,onUnmountAutoFocus:s,children:(0,j.jsx)(o.XB,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:f,onEscapeKeyDown:d,onPointerDownOutside:h,onFocusOutside:p,onDismiss:()=>x.onOpenChange(!1),children:(0,j.jsx)(u.VY,{"data-state":A(x.open),role:"dialog",id:x.contentId,...g,...m,ref:t,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),_="PopoverClose";function A(e){return e?"open":"closed"}n.forwardRef((e,t)=>{let{__scopePopover:r,...n}=e,s=k(_,r);return(0,j.jsx)(f.WV.button,{type:"button",...n,ref:t,onClick:(0,a.M)(e.onClick,()=>s.onOpenChange(!1))})}).displayName=_,n.forwardRef((e,t)=>{let{__scopePopover:r,...n}=e,a=C(r);return(0,j.jsx)(u.Eh,{...a,...n,ref:t})}).displayName="PopoverArrow";var V=S,B=O,K=L,W=T},47250:function(e,t,r){"use strict";r.d(t,{D:function(){return a}});var n=r(2265);function a(e){let t=n.useRef({value:e,previous:e});return n.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}}},function(e){e.O(0,[4358,4728,2641,231,7255,4086,5510,9279,3070,1288,8538,3053,2971,7023,1744],function(){return e(e.s=27709)}),_N_E=e.O()}]);