(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8859],{28775:function(e,t,s){Promise.resolve().then(s.bind(s,23009))},23009:function(e,t,s){"use strict";s.d(t,{LoggedEntriesView:function(){return U}});var n=s(57437),i=s(2265),l=s(87138),a=s(16463),r=s(21413),c=s(89733),d=s(34063),o=s(69081),h=s(48185),x=s(47304),m=s(70402),j=s(98630),u=s(18422),f=s(86644),p=s(17219),v=s(38087),N=s(60926),g=s(85915),y=s(91241),b=s(69893),w=s(19847),C=s(82469),S=s(37458),P=s(31313),Z=s(19779),D=s(86763),k=s(15410),L=s(68965),F=s(49354),O=s(31590),R=s(29943),T=s(51328);let M=e=>"".concat(Math.floor(e/3600),"h ").concat(Math.floor(e%3600/60),"m"),z=e=>{let t=new Date(e);return t.setHours(23,59,59,999),t};function U(){let[e,t]=(0,i.useState)([]),[s,U]=(0,i.useState)([]),[E,W]=(0,i.useState)(!0),[_,I]=(0,i.useState)(null),[Y,A]=(0,i.useState)(void 0),[$,B]=(0,i.useState)(!1),[J,H]=(0,i.useState)(null),[X,q]=(0,i.useState)(null),{user:G}=(0,Z.a)(),{toast:Q}=(0,D.pm)(),{handlePrint:V,contentRef:K}=(0,k.Y)(),ee=(0,a.useRouter)();(0,i.useEffect)(()=>{!async function(){if(!G){W(!1);return}W(!0);try{let[e,s]=await Promise.all([(0,L.PZ)(G.uid),(0,L.m)(G.uid)]);t(e),U(s)}catch(e){Q({variant:"destructive",title:"Failed to load data",description:e.message})}finally{W(!1)}}()},[G,Q]);let et=(0,i.useMemo)(()=>_?s.filter(e=>e.accountId===_).filter(e=>{if(!Y||!Y.from)return!0;let t=new Date(e.startTime),s=Y.to||Y.from;return t>=Y.from&&t<=z(s)}):[],[_,s,Y]),es=(0,i.useMemo)(()=>et.reduce((e,t)=>e+t.duration,0),[et]),en=(0,i.useMemo)(()=>et.reduce((e,t)=>e+t.duration/3600*t.billableRate,0),[et]),ei=async e=>{try{await (0,L.Q_)(e.id,e),U(t=>t.map(t=>t.id===e.id?{...t,...e}:t)),Q({title:"Entry Updated",description:"Your changes have been saved."})}catch(e){Q({variant:"destructive",title:"Update Failed",description:e.message})}},el=async()=>{if(X)try{await (0,L.Zs)(X.id),U(e=>e.filter(e=>e.id!==X.id)),Q({title:"Entry Deleted",description:'The log entry "'.concat(X.subject,'" has been removed.')})}catch(e){Q({variant:"destructive",title:"Delete Failed",description:e.message})}finally{q(null)}},ea=e.find(e=>e.id===_);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"p-4 sm:p-6 space-y-6",children:[(0,n.jsxs)("header",{className:"flex items-center justify-between print:hidden",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold font-headline text-primary",children:"Client Time Log Report"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Generate a detailed report of time logged for a client."})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)(c.z,{variant:"outline",onClick:()=>{if(!ea||0===et.length){Q({variant:"destructive",title:"Cannot Create Invoice",description:"Please select a client with time log entries in the selected range."});return}let e=et.filter(e=>e.billableRate>0&&e.duration>0).map(e=>{let t=e.duration/3600;return{description:"".concat(e.subject," - ").concat((0,P.WU)(e.startTime,"PPP")),quantity:parseFloat(t.toFixed(2)),price:e.billableRate}});if(0===e.length){Q({variant:"destructive",title:"No Billable Items",description:"There are no billable time entries in this report."});return}try{let t={contactId:ea.contactId,lineItems:e};sessionStorage.setItem("invoiceFromReportData",JSON.stringify(t)),ee.push("/accounting/invoices/create")}catch(e){console.error("Failed to prepare invoice data:",e),Q({variant:"destructive",title:"Error",description:"Could not prepare the invoice data for generation."})}},disabled:!_,children:[(0,n.jsx)(j.Z,{className:"mr-2 h-4 w-4"}),"Create Invoice"]}),(0,n.jsxs)(c.z,{variant:"outline",onClick:V,disabled:!_,children:[(0,n.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Print Report"]}),(0,n.jsx)(c.z,{asChild:!0,children:(0,n.jsxs)(l.default,{href:"/client-manager",children:[(0,n.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),"Back to Client Hub"]})})]})]}),(0,n.jsxs)(h.Zb,{className:"print:hidden",children:[(0,n.jsx)(h.Ol,{children:(0,n.jsx)(h.ll,{children:"Report Filters"})}),(0,n.jsxs)(h.aY,{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(m.Label,{children:"Client"}),(0,n.jsxs)(r.J2,{open:$,onOpenChange:B,children:[(0,n.jsx)(r.xo,{asChild:!0,children:(0,n.jsxs)(c.z,{variant:"outline",role:"combobox",className:"w-full justify-between",children:[(null==ea?void 0:ea.name)||"Select client...",(0,n.jsx)(p.Z,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,n.jsx)(r.yk,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,n.jsxs)(d.mY,{children:[(0,n.jsx)(d.sZ,{placeholder:"Search clients..."}),(0,n.jsxs)(d.e8,{children:[(0,n.jsx)(d.rb,{children:E?(0,n.jsx)(v.Z,{className:"h-4 w-4 animate-spin"}):"No client found."}),(0,n.jsx)(d.fu,{children:e.map(e=>(0,n.jsxs)(d.di,{value:e.name,onSelect:()=>{I(e.id),B(!1)},children:[" ",(0,n.jsx)(N.Z,{className:(0,F.cn)("mr-2 h-4 w-4",_===e.id?"opacity-100":"opacity-0")}),e.name]},e.id))})]})]})})]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(m.Label,{children:"Date Range"}),(0,n.jsxs)(r.J2,{children:[(0,n.jsx)(r.xo,{asChild:!0,children:(0,n.jsxs)(c.z,{variant:"outline",className:(0,F.cn)("w-full justify-start text-left font-normal",!Y&&"text-muted-foreground"),children:[(0,n.jsx)(g.Z,{className:"mr-2 h-4 w-4"}),(null==Y?void 0:Y.from)?Y.to?"".concat((0,P.WU)(Y.from,"LLL dd, y")," - ").concat((0,P.WU)(Y.to,"LLL dd, y")):(0,P.WU)(Y.from,"LLL dd, y"):(0,n.jsx)("span",{children:"Pick a date range"})]})}),(0,n.jsx)(r.yk,{className:"w-auto p-0",align:"start",children:(0,n.jsx)(o.f,{initialFocus:!0,mode:"range",defaultMonth:null==Y?void 0:Y.from,selected:Y,onSelect:A,numberOfMonths:2})})]})]}),(0,n.jsxs)("div",{className:"flex items-end gap-2",children:[(0,n.jsx)(c.z,{variant:"secondary",onClick:()=>A({from:(0,C.N)(new Date),to:new Date}),className:"w-full",children:"Month to Date"}),(0,n.jsx)(c.z,{variant:"secondary",onClick:()=>A({from:(0,S.e)(new Date),to:new Date}),className:"w-full",children:"Year to Date"}),(0,n.jsx)(c.z,{variant:"secondary",onClick:()=>A(void 0),className:"w-full",children:"Clear"})]})]})]}),(0,n.jsx)("div",{ref:K,children:(0,n.jsxs)(h.Zb,{className:"print:border-none print:shadow-none",children:[(0,n.jsxs)(h.Ol,{className:"text-center",children:[(0,n.jsxs)(h.ll,{className:"text-2xl",children:[(null==ea?void 0:ea.name)||"Client"," - Time Report"]}),(0,n.jsx)(h.SZ,{children:(null==Y?void 0:Y.from)?Y.to?"".concat((0,P.WU)(Y.from,"PPP")," to ").concat((0,P.WU)(Y.to,"PPP")):"On ".concat((0,P.WU)(Y.from,"PPP")):"All time"})]}),(0,n.jsx)(h.aY,{children:E?(0,n.jsx)("div",{className:"h-48 flex items-center justify-center",children:(0,n.jsx)(v.Z,{className:"h-8 w-8 animate-spin"})}):_?(0,n.jsxs)(x.iA,{children:[(0,n.jsx)(x.xD,{children:(0,n.jsxs)(x.SC,{children:[(0,n.jsx)(x.ss,{children:"Date"}),(0,n.jsx)(x.ss,{children:"Subject"}),(0,n.jsx)(x.ss,{className:"text-right",children:"Duration"}),(0,n.jsx)(x.ss,{className:"text-right",children:"Billable"}),(0,n.jsx)(x.ss,{className:"w-10",children:(0,n.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,n.jsx)(x.RM,{children:et.length>0?et.map(e=>(0,n.jsxs)(x.SC,{children:[(0,n.jsx)(x.pj,{children:(0,P.WU)(e.startTime,"yyyy-MM-dd")}),(0,n.jsx)(x.pj,{children:e.subject}),(0,n.jsx)(x.pj,{className:"text-right font-mono",children:M(e.duration)}),(0,n.jsxs)(x.pj,{className:"text-right font-mono",children:["$",(e.duration/3600*e.billableRate).toFixed(2)]}),(0,n.jsx)(x.pj,{children:(0,n.jsxs)(O.h_,{children:[(0,n.jsx)(O.$F,{asChild:!0,children:(0,n.jsx)(c.z,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,n.jsx)(y.Z,{className:"h-4 w-4"})})}),(0,n.jsxs)(O.AW,{align:"end",children:[(0,n.jsxs)(O.Xi,{onSelect:()=>H(e),children:[(0,n.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),"Open / Edit"]}),(0,n.jsxs)(O.Xi,{className:"text-destructive",onSelect:()=>q(e),children:[(0,n.jsx)(w.Z,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},e.id)):(0,n.jsx)(x.SC,{children:(0,n.jsx)(x.pj,{colSpan:5,className:"h-24 text-center",children:"No entries found for this period."})})}),(0,n.jsx)(x.yt,{children:(0,n.jsxs)(x.SC,{children:[(0,n.jsx)(x.pj,{colSpan:2,className:"font-bold",children:"Totals"}),(0,n.jsx)(x.pj,{className:"text-right font-bold font-mono",children:M(es)}),(0,n.jsxs)(x.pj,{className:"text-right font-bold font-mono",children:["$",en.toFixed(2)]}),(0,n.jsx)(x.pj,{})]})})]}):(0,n.jsx)("div",{className:"h-48 flex items-center justify-center",children:(0,n.jsx)("p",{className:"text-muted-foreground",children:"Please select a client to generate a report."})})})]})})]}),(0,n.jsx)(T.Z,{isOpen:!!J,onOpenChange:()=>H(null),entry:J,onSave:ei}),(0,n.jsx)(R.aR,{open:!!X,onOpenChange:()=>q(null),children:(0,n.jsxs)(R._T,{children:[(0,n.jsxs)(R.fY,{children:[(0,n.jsx)(R.f$,{children:"Are you absolutely sure?"}),(0,n.jsxs)(R.yT,{children:['This action will permanently delete the log entry: "',null==X?void 0:X.subject,'". This cannot be undone.']})]}),(0,n.jsxs)(R.xo,{children:[(0,n.jsx)(R.le,{children:"Cancel"}),(0,n.jsx)(R.OL,{onClick:el,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})})]})}}},function(e){e.O(0,[4358,4728,2641,231,7255,4086,5510,9279,3070,6680,23,1792,1313,6669,4694,1288,9125,3053,7186,2971,7023,1744],function(){return e(e.s=28775)}),_N_E=e.O()}]);